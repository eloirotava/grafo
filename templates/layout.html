<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - RotavaFlow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; height: 100vh; font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f0f0f0; display: flex; flex-direction: column; overflow: hidden; }
        .menubar { height: 35px; background-color: #f3f3f3; display: flex; align-items: center; padding: 0 10px; border-bottom: 1px solid #d1d1d1; user-select: none; }
        .nav-link { text-decoration: none; color: #333; padding: 0 15px; font-size: 13px; height: 100%; display: flex; align-items: center; border-bottom: 3px solid transparent; transition: all 0.2s; }
        .nav-link:hover { background-color: #e6e6e6; }
        .nav-link.active { background-color: #e1e1e1; font-weight: 600; border-bottom: 3px solid #0078d7; color: #000; }
        .file-menu-btn { padding: 0 15px; font-size: 13px; height: 100%; display: flex; align-items: center; cursor: pointer; color: #333; }
        .file-menu-btn:hover { background-color: #e6e6e6; }
        .dropdown { display: none; position: absolute; top: 35px; left: 0; background: white; border: 1px solid #ccc; box-shadow: 3px 3px 10px rgba(0,0,0,0.1); min-width: 220px; z-index: 2000; }
        .dropdown div { padding: 10px 20px; cursor: pointer; font-size: 13px; }
        .dropdown div:hover { background-color: #f0f0f0; color: #0078d7; }
        .main-container { flex-grow: 1; display: flex; position: relative; height: calc(100vh - 35px); overflow: auto; flex-direction: column; }
    </style>
</head>
<body>
    <div class="menubar">
        <div class="file-menu-btn" onclick="document.getElementById('file-menu').style.display = document.getElementById('file-menu').style.display=='block'?'none':'block'">
            <span>&#9776; Arquivo</span>
            <div id="file-menu" class="dropdown">
                <div onclick="document.getElementById('file-input').click()">Abrir Local</div>
                <div onclick="if(window.saveLocal) window.saveLocal()">Salvar Local</div>
                <div onclick="if(window.saveToPython) window.saveToPython()">Salvar (Ctrl+S)</div>
                <div onclick="location.reload()">Recarregar</div>
            </div>
        </div>
        <a href="/" class="nav-link {% if request.url.path == '/' %}active{% endif %}">Início</a>
        <a href="/canvas" class="nav-link {% if request.url.path == '/canvas' %}active{% endif %}">Editor P&ID</a>
        <a href="/nodes" class="nav-link {% if request.url.path == '/nodes' %}active{% endif %}">Nós</a>
        <a href="/ducts" class="nav-link {% if request.url.path == '/ducts' %}active{% endif %}">Tubulação</a>
        <a href="/equipments" class="nav-link {% if request.url.path == '/equipments' %}active{% endif %}">Equipamentos</a>
        <a href="/simulation" class="nav-link {% if request.url.path == '/simulation' %}active{% endif %}">Simulação</a>
        <a href="/reports" class="nav-link {% if request.url.path == '/reports' %}active{% endif %}">Relatórios</a>
        <a href="/help" class="nav-link {% if request.url.path == '/help' %}active{% endif %}" style="margin-left: auto;">Ajuda</a>
    </div>
    <input type="file" id="file-input" style="display: none;" onchange="if(window.loadLocal) window.loadLocal(event)">
    <div class="main-container">{% block content %}{% endblock %}</div>
    <script>
        window.onclick = function(e) { if (!e.target.closest('.file-menu-btn')) document.querySelectorAll('.dropdown').forEach(d => d.style.display = 'none'); }
    </script>
</body>
</html>